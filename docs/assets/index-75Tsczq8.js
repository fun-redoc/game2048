(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&e(f)}).observe(document,{childList:!0,subtree:!0});function t(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerPolicy&&(u.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?u.credentials="include":r.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function e(r){if(r.ep)return;r.ep=!0;const u=t(r);fetch(r.href,u)}})();const a=document.getElementById("canvas"),b=document.getElementById("k");let w=Number.parseInt(b.value)|3,n=[];const c={vertButtonWidth:50,horzButtonHeigth:50};let i={topButtonRow:[],bottomButtonRow:[],leftButtonCol:[],rightButtonCol:[],field:[]};const x=[];b.onchange=l=>{const o=l.target;if(o.value){const t=Number.parseInt(o.value);x.push({kind:"restart",k:t})}};a.onmouseup=l=>{const o={x:l.offsetX,y:l.offsetY};let t;for(let e=0;e<i.topButtonRow.length;e++)if(y(o,i.topButtonRow[e])){t={kind:"playUp",col:e};break}if(t===void 0){for(let e=0;e<i.bottomButtonRow.length;e++)if(y(o,i.bottomButtonRow[e])){t={kind:"playDown",col:e};break}}if(t===void 0){for(let e=0;e<i.leftButtonCol.length;e++)if(y(o,i.leftButtonCol[e])){t={kind:"playLeft",row:e};break}}if(t===void 0){for(let e=0;e<i.rightButtonCol.length;e++)if(y(o,i.rightButtonCol[e])){t={kind:"playRight",row:e};break}}if(t===void 0){for(let e=0;e<i.field.length;e++)for(let r=0;r<i.field[e].length;r++)if(y(o,i.field[e][r])){switch(l.button){case 0:t={kind:"setFour",row:e,col:r};break;case 2:t={kind:"setTwo",row:e,col:r};break}break}}t!==void 0&&x.push(t)};v(w);requestAnimationFrame(l=>{requestAnimationFrame(o=>k())});function v(l){n=[],i={topButtonRow:[],bottomButtonRow:[],leftButtonCol:[],rightButtonCol:[],field:[]};for(let s=0;s<l;s++){n.push([]);for(let h=0;h<l;h++)n[s].push(0)}let o={x:c.vertButtonWidth,y:0},t={x:c.vertButtonWidth,y:c.horzButtonHeigth+a.height-2*c.horzButtonHeigth},e=1/l*(a.width-2*c.vertButtonWidth);for(let s=0;s<l;s++){let h=o.x+s*e,d=o.y,B={x:h,y:d,w:e,h:c.horzButtonHeigth};i.topButtonRow.push(B),h=t.x+s*e,d=t.y;let p={x:h,y:d,w:e,h:c.horzButtonHeigth};i.bottomButtonRow.push(p)}let r={x:0,y:c.horzButtonHeigth},u={x:c.vertButtonWidth+a.width-2*c.vertButtonWidth,y:c.horzButtonHeigth},f=1/l*(a.height-2*c.horzButtonHeigth);for(let s=0;s<l;s++){let h=r.x,d=r.y+s*f,B={x:h,y:d,w:c.vertButtonWidth,h:f};i.leftButtonCol.push(B),h=u.x,d=u.y+s*f;let p={x:h,y:d,w:c.vertButtonWidth,h:f};i.rightButtonCol.push(p)}let m={x:c.vertButtonWidth,y:c.horzButtonHeigth},g={x:1/l*(a.width-2*c.vertButtonWidth),y:1/l*(a.height-2*c.horzButtonHeigth)};for(let s=0;s<l;s++){i.field.push([]);for(let h=0;h<l;h++)i.field[s].push({x:m.x+h*g.x,y:m.y+s*g.y,w:g.x,h:g.y})}}function y(l,o){return o.x<=l.x&&l.x<=o.x+o.w&&o.y<=l.y&&l.y<=o.y+o.h}function R(l){for(let o=x.pop();o;o=x.pop())switch(o.kind){case"setFour":console.log(`Ã¨vent ${o.row},${o.col}`),n[o.row][o.col]===0&&(n[o.row][o.col]=4);break;case"setTwo":n[o.row][o.col]===0&&(n[o.row][o.col]=2);break;case"playLeft":{const t=n[o.row];for(let e=0;e<t.length;e++)if(t[e]!==0&&t[e]===t[e+1]){t[e]+=t[e+1];for(let r=e+1;r<t.length-1;r++)t[r]=t[r+1];t[t.length-1]=0}}break;case"playRight":{const t=n[o.row];for(let e=t.length-1;e>0;e--)if(t[e]!==0&&t[e]===t[e-1]){t[e]+=t[e-1];for(let r=e-1;r>0;r--)t[r]=t[r-1];t[0]=0}}break;case"playDown":for(let t=n.length-1;t>0;t--)if(n[t][o.col]!==0&&n[t][o.col]===n[t-1][o.col]){n[t][o.col]+=n[t-1][o.col];for(let e=t-1;e>0;e--)n[e][o.col]=n[e-1][o.col];n[0][o.col]=0}break;case"playUp":for(let t=0;t<n.length;t++)if(n[t][o.col]!==0&&n[t][o.col]===n[t+1][o.col]){n[t][o.col]+=n[t+1][o.col];for(let e=t+1;e<n.length-1;e++)n[e][o.col]=n[e+1][o.col];n[n.length-1][o.col]=0}break;case"restart":w=o.k,v(w)}}function S(){const l=a.getContext("2d");l.save(),l.font="48px courier-new",l.textBaseline="middle",l.textAlign="center",l.lineWidth=5,l.strokeStyle="blue",l.fillStyle="white",l.save();for(let o=0;o<i.topButtonRow.length;o++){const t=i.topButtonRow[o];l.fillRect(t.x,t.y,t.w,t.h),l.strokeRect(t.x,t.y,t.w,t.h),l.strokeStyle="black";let e="U";const r={x:t.x+t.w/2,y:t.y+t.h/2};l.strokeText(e,r.x,r.y)}l.restore(),l.save();for(let o=0;o<i.bottomButtonRow.length;o++){const t=i.bottomButtonRow[o];l.fillRect(t.x,t.y,t.w,t.h),l.strokeRect(t.x,t.y,t.w,t.h),l.strokeStyle="black";let e="D";const r={x:t.x+t.w/2,y:t.y+t.h/2};l.strokeText(e,r.x,r.y)}l.restore(),l.save();for(let o=0;o<i.leftButtonCol.length;o++){const t=i.leftButtonCol[o];l.fillRect(t.x,t.y,t.w,t.h),l.strokeRect(t.x,t.y,t.w,t.h),l.strokeStyle="black";let e="L";const r={x:t.x+t.w/2,y:t.y+t.h/2};l.strokeText(e,r.x,r.y)}l.restore(),l.save();for(let o=0;o<i.rightButtonCol.length;o++){const t=i.rightButtonCol[o];l.fillRect(t.x,t.y,t.w,t.h),l.strokeRect(t.x,t.y,t.w,t.h),l.strokeStyle="black";let e="R";const r={x:t.x+t.w/2,y:t.y+t.h/2};l.strokeText(e,r.x,r.y)}l.restore(),l.save(),l.fillStyle="gray";for(let o=0;o<w;o++)for(let t=0;t<w;t++){const e=i.field[o][t];if(l.fillRect(e.x,e.y,e.w,e.h),l.strokeStyle="blue",l.strokeRect(e.x,e.y,e.w,e.h),n[o][t]){const r={x:e.x+e.w/2,y:e.y+e.h/2};l.strokeStyle="white";let u=n[o][t].toString();l.strokeText(u,r.x,r.y)}}l.restore(),l.restore()}function k(l,o){R(),S(),requestAnimationFrame(t=>k())}
